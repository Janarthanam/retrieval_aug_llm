version: '3'
services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    image: retriever_aug_llm:latest
    depends_on:
      - redis
    environment:
      - OPENAI_API_KEY="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"
      - CELERY_BROKER_URL='redis://redis:6379/0'
      - CELERY_RESULT_BACKEND ='redis://redis:6379/0'
    ports:
      - 8051
      - 8088
  
  # celery:
  #   image: retriever_aug_llm:latest
  #   command: celery -A worker.celery worker --loglevel=info
  #   environment:
  #     - CELERY_BROKER_URL=redis://redis:6379/0
  #     - CELERY_RESULT_BACKEND=redis://redis:6379/0
  #   depends_on:
  #     - api
  #     - redis

  redis:
      image: redis:7
      ports:
        - 6379